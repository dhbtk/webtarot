input {
  gelf {
    host => "0.0.0.0"
    port => 12201
  }
}

filter {
  # Attempt to parse JSON message field emitted by the app
  json {
    source => "message"
    target => "json"
    skip_on_invalid_json => true
  }

  # Flatten selected fields for easier querying
  mutate {
    add_field => {
      "app.tag" => "%{tag}"
      "container.name" => "%{container_name}"
      "container.id" => "%{container_id}"
    }
  }
}

output {
  # For local debugging
  stdout { codec => rubydebug }

  elasticsearch {
    hosts => ["http://elasticsearch:9200"]
    user => "elastic"
    password => "${ELASTIC_PASSWORD}"
    index => "webtarot-logs-%{+YYYY.MM.dd}"
  }
}
